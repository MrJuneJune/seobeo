<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>API Requests</title>
  <style>
    input, textarea { display: block; margin-bottom: 10px; width: 300px; }
  </style>
</head>
<body>
  <h1>API Request Tester</h1>

  <form id="exampleForm">
    <label>id: <input name="id" value="b6d4c431-f327-4a4a-9345-320aa3cd7e31" /></label>
    <label>small_int_col: <input name="small_int_col" type="number" value="1" /></label>
    <label>int_col: <input name="int_col" type="number" value="42" /></label>
    <label>big_int_col: <input name="big_int_col" type="number" value="9000000000" /></label>
    <label>decimal_col: <input name="decimal_col" type="number" step="any" value="12.34" /></label>
    <label>numeric_col: <input name="numeric_col" type="number" step="any" value="56.789" /></label>
    <label>real_col: <input name="real_col" type="number" step="any" value="1.23" /></label>
    <label>double_col: <input name="double_col" type="number" step="any" value="9.87" /></label>
    <label>char_col: <input name="char_col" value="char_data" /></label>
    <label>varchar_col: <input name="varchar_col" value="varchar_data" /></label>
    <label>text_col: <input name="text_col" value="This is a long text" /></label>
    <label>date_col: <input name="date_col" type="date" value="2025-06-05" /></label>
    <label>time_col: <input name="time_col" type="time" value="12:34:56" /></label>
    <label>timestamp_col: <input name="timestamp_col" value="2025-06-05 12:34:56" /></label>
    <label>timestamptz_col: <input name="timestamptz_col" value="2025-06-05 12:34:56+00" /></label>
    <label>boolean_col: <input name="boolean_col" type="checkbox" checked /></label>
    <label>another_uuid: <input name="another_uuid" value="d1b355c0-f348-4bcf-b3df-ef95b3a8a3ad" /></label>
    <label>json_col (as JSON): <textarea name="json_col">{ "key": "value" }</textarea></label>
    <label>jsonb_col (as JSON): <textarea name="jsonb_col">{ "key": "value" }</textarea></label>
    <label>int_array_col (comma-separated): <input name="int_array_col" value="1,2,3" /></label>
    <label>text_array_col (comma-separated): <input name="text_array_col" value="apple,banana" /></label>
    <label>status_col: <input name="status_col" value="active" /></label>
    <label>file_col: <input name="file_col" value="\\x68656c6c6f" /></label>
  </form>

  <button onclick="makeGetRequest()">GET /api/foo</button>
  <button onclick="makePostRequest()">POST /api/foo</button>
  <button onclick="makeDeleteRequest()">DELETE /api/foo</button>
  <button onclick="makePutRequest()">PUT /api/foo</button>

  <p id="response"></p>

  <script>
    const baseUrl = 'http://localhost:6969/api/foo';

    function getFormData() {
      const form = document.getElementById('exampleForm');
      const formData = new FormData(form);
      const json = {};

      for (const [key, value] of formData.entries()) {
        switch (key) {
          case 'small_int_col':
          case 'int_col':
          case 'big_int_col':
            json[key] = parseInt(value);
            break;
          case 'decimal_col':
          case 'numeric_col':
          case 'real_col':
          case 'double_col':
            json[key] = parseFloat(value);
            break;
          case 'boolean_col':
            json[key] = form.elements['boolean_col'].checked;
            break;
          case 'int_array_col':
            json[key] = value.split(',').map(s => parseInt(s.trim()));
            break;
          case 'text_array_col':
            json[key] = value.split(',').map(s => s.trim());
            break;
          case 'json_col':
          case 'jsonb_col':
            try {
              json[key] = JSON.parse(value);
            } catch {
              json[key] = {}; // fallback
            }
            break;
          default:
            json[key] = value;
        }
      }

      return json;
    }

    function handleResponse(responsePromise, method) {
      responsePromise
        .then(response => response.json())
        .then(data => {
          document.getElementById('response').textContent = `${method} Response: ` + JSON.stringify(data, null, 2);
        })
        .catch(error => {
          document.getElementById('response').textContent = 'Error: ' + error;
        });
    }

    function makeGetRequest() {
      handleResponse(fetch(baseUrl, { method: 'GET' }), 'GET');
    }

    function makePostRequest() {
      const body = getFormData();
      handleResponse(fetch(baseUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      }), 'POST');
    }

    function makePutRequest() {
      const body = getFormData();
      handleResponse(fetch(baseUrl, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      }), 'PUT');
    }

    function makeDeleteRequest() {
      handleResponse(fetch(baseUrl, { method: 'DELETE' }), 'DELETE');
    }
  </script>
</body>
</html>
